/* SSintervals contain the start and end times of sea states*/
/* timeObs contains the observed times*/
/* use the intervals in SSintervals to assign sea states to times in timeobs */

data SSintervals ;
format startI endI datetime16. ;
  input ss $2. +1 startI datetime16. +1 endI datetime16. ;
  datalines;
1H 01jan12:00:00:00 01jan12:23:23:59
2L 02jan12:00:00:00 02jan12:23:23:59
2H 03jan12:00:00:00 03jan12:23:23:59
3L 04jan12:00:00:00 04jan12:23:23:59
;
run;

data timeObs ;
  format timeObs datetime16. ;
  input timeObs datetime16. ;
  datalines ;
01jan12:00:23:59
03jan12:00:23:59
02jan12:00:23:59
04jan12:00:00:59
01jan12:00:11:59
;
run;

data intervalFmt ;
  length fmtname $8 type $1 start end $16 label $40 ;
  retain fmtname 'ssTI' type 'N' ;
  set ssIntervals ;
  label = ss ;
  start = put(startI,16.) ;
  end = put(endI,16.) ;
run;

proc format library=work cntlin=intervalFmt ; run;

data test ;
  length seaState $2. ;
  set timeObs ;
  seaState = put(timeObs,ssti.) ;
run;

/********************************************/
/* "mutilevel" format */

/* The goal is to assign an airport code based on a serial number and event date 
   One format was created for each serial number since some devices moved to another airport 
   So this data step is creating like 200+ formats because there are 200+ devices
*/
data intervalFmt (keep=fmtname type start end label );
  length fmtname $8 type $1 start end $40 label $40 ;
  retain fmtname 'ssTI' type 'N' ;  /* ssTI gets overwritten, so doesn't matter */
  /* Since start is numeric, need to put type 'N' */
  set deployment_dtls ; /* this data set contained the serial number, start and end dates of deployment, and the airport code*/
  fmtname = 's'||put(serial_number,6.)||'n';  /* ex: S181497n .  Needs to start and end with a character so added the 's' and 'n'*/
  label = facility_airport ;  /* this is the airport code, like BWI*/
  start = datepart(start_date); /* this assigns the start of the interval, taking just the date part */
  if end_Date eq . then end = '31Dec2015'd; /* some devices did not move, so assigned the end date to end of Q4 */
  else end = datepart(end_date);  /* if a device moved, then assign the end of the interval*/
run;

proc format library=work cntlin=intervalFmt ; run; quit;

/* Applying format to add airports */
data warning_dtls_downtimes2 ;
  set warning_dtls_downtimes ;
  facility_airport = putn(datepart(full_event_date),'s'||put(serial_number,6.)||'n.');
run;
